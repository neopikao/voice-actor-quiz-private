<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â£∞ÂÑ™Ê•≠ÁïåÂïèÈ°åÈõÜ„Ç¢„Éó„É™</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        .quiz-container {
            min-height: 100vh;
            max-height: 100vh;
            overflow-y: auto;
        }
        .answer-feedback {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .correct-answer {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
        }
        .incorrect-answer {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 2px solid #dc3545;
        }
        .question-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 123, 255, 0.3);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);
        }
        .option-btn {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .option-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .option-btn.selected {
            border-color: #007bff;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }
        .progress-bar {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            transition: width 0.3s ease;
        }
        .compact-text {
            font-size: 0.85rem;
            line-height: 1.3;
        }
        .compact-title {
            font-size: 1rem;
            line-height: 1.2;
            margin-bottom: 0.5rem;
        }
        .compact-btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }
        .mobile-optimized {
            max-height: 100vh;
            overflow-y: auto;
            padding: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="mobile-optimized">
        <!-- „É°„Ç§„É≥„É°„Éã„É•„Éº -->
        <div id="main-menu" class="quiz-container flex items-center justify-center p-4">
            <div class="w-full max-w-md">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Â£∞ÂÑ™Ê•≠ÁïåÂïèÈ°åÈõÜ</h1>
                    <p class="text-gray-600">„Éó„É≠„ÅÆÂ£∞ÂÑ™„ÇíÁõÆÊåá„Åô„Åü„ÇÅ„ÅÆÂ≠¶Áøí„Ç¢„Éó„É™</p>
                </div>
                
                <div class="question-card p-6 mb-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Âá∫È°åÊï∞</label>
                            <select id="question-count" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="5">5Âïè</option>
                                <option value="10" selected>10Âïè</option>
                                <option value="15">15Âïè</option>
                                <option value="20">20Âïè</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Âá∫È°åÂàÜÈáé</label>
                            <select id="question-category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">ÂÖ®ÂàÜÈáé„É©„É≥„ÉÄ„É†</option>
                            </select>
                        </div>
                        
                        <button id="start-quiz" class="w-full btn-primary text-white py-3 px-6 rounded-lg font-semibold">
                            <i class="fas fa-play mr-2"></i>„ÇØ„Ç§„Ç∫ÈñãÂßã
                        </button>
                    </div>
                </div>
                
                <div class="text-center">
                    <button id="admin-mode" class="text-blue-600 hover:text-blue-800 text-sm">
                        <i class="fas fa-cog mr-1"></i>ÁÆ°ÁêÜ„É¢„Éº„Éâ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- „ÇØ„Ç§„Ç∫ÁîªÈù¢ -->
        <div id="quiz-screen" class="quiz-container p-2 hidden">
            <div class="w-full max-w-md mx-auto">
                <!-- ÈÄ≤Êçó„Éê„Éº -->
                <div class="mb-3">
                    <div class="flex justify-between items-center mb-2">
                        <span class="compact-text text-gray-600">ÂïèÈ°å <span id="current-question">1</span>/<span id="total-questions">10</span></span>
                        <span class="compact-text text-gray-600">Ê≠£Ëß£Áéá: <span id="accuracy">0%</span></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- ÂïèÈ°å„Ç´„Éº„Éâ -->
                <div class="question-card p-4 mb-3">
                    <div id="question-content">
                        <h3 id="question-text" class="compact-title font-semibold text-gray-800 mb-3"></h3>
                        <div id="question-options" class="space-y-2 mb-3"></div>
                        <div id="question-hint" class="text-sm text-blue-600 mb-3 hidden">
                            <i class="fas fa-lightbulb mr-1"></i>
                            <span id="hint-text"></span>
                        </div>
                    </div>
                    
                    <!-- ÂõûÁ≠îÁµêÊûú -->
                    <div id="answer-feedback" class="answer-feedback mb-3 p-3 rounded-lg hidden">
                        <div id="result-icon" class="text-center text-2xl mb-2"></div>
                        <div id="result-text" class="compact-text text-center font-semibold mb-2"></div>
                        <div id="user-answer" class="compact-text mb-2"></div>
                        <div id="correct-answer" class="compact-text mb-2"></div>
                        <div id="explanation" class="compact-text text-gray-700"></div>
                    </div>
                </div>
                
                <!-- „Éú„Çø„É≥Áæ§ -->
                <div class="flex gap-2 mb-2">
                    <button id="submit-answer" class="flex-1 btn-success text-white compact-btn rounded-lg font-semibold hidden">
                        <i class="fas fa-check mr-1"></i>ÂõûÁ≠î„Åô„Çã
                    </button>
                    <button id="show-hint" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white compact-btn rounded-lg font-semibold">
                        <i class="fas fa-lightbulb mr-1"></i>„Éí„É≥„Éà
                    </button>
                </div>
                
                <div class="flex gap-2">
                    <button id="next-question" class="flex-1 btn-primary text-white compact-btn rounded-lg font-semibold hidden">
                        <i class="fas fa-arrow-right mr-1"></i>Ê¨°„ÅÆÂïèÈ°å
                    </button>
                    <button id="back-to-menu" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white compact-btn rounded-lg font-semibold">
                        <i class="fas fa-home mr-1"></i>„É°„Éã„É•„Éº„Å´Êàª„Çã
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ÁµêÊûúÁîªÈù¢ -->
        <div id="result-screen" class="quiz-container flex items-center justify-center p-4 hidden">
            <div class="w-full max-w-md">
                <div class="question-card p-6 text-center">
                    <div id="final-score" class="text-4xl font-bold text-blue-600 mb-4"></div>
                    <div id="final-message" class="text-xl font-semibold text-gray-800 mb-4"></div>
                    <div id="final-stats" class="text-gray-600 mb-6"></div>
                    
                    <div class="space-y-3">
                        <button id="retry-quiz" class="w-full btn-primary text-white py-3 px-6 rounded-lg font-semibold">
                            <i class="fas fa-redo mr-2"></i>„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶
                        </button>
                        <button id="back-to-main" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-semibold">
                            <i class="fas fa-home mr-2"></i>„É°„Éã„É•„Éº„Å´Êàª„Çã
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÁÆ°ÁêÜÁîªÈù¢ -->
        <div id="admin-screen" class="quiz-container p-4 hidden">
            <div class="w-full max-w-2xl mx-auto">
                <div class="question-card p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">ÁÆ°ÁêÜ„É¢„Éº„Éâ</h2>
                        <button id="close-admin" class="text-gray-600 hover:text-gray-800">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-4">
                            <button id="import-excel" class="w-full btn-primary text-white py-3 px-6 rounded-lg font-semibold">
                                <i class="fas fa-upload mr-2"></i>Excel„Ç§„É≥„Éù„Éº„Éà
                            </button>
                            <button id="export-excel" class="w-full btn-success text-white py-3 px-6 rounded-lg font-semibold">
                                <i class="fas fa-download mr-2"></i>Excel„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                            </button>
                        </div>
                        <div class="space-y-4">
                            <button id="clear-data" class="w-full btn-danger text-white py-3 px-6 rounded-lg font-semibold">
                                <i class="fas fa-trash mr-2"></i>„Éá„Éº„Çø„ÇØ„É™„Ç¢
                            </button>
                            <div class="text-sm text-gray-600">
                                <p>ÂïèÈ°åÊï∞: <span id="question-count-display">0</span></p>
                                <p>ÂàÜÈáéÊï∞: <span id="category-count-display">0</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <input type="file" id="file-input" accept=".xlsx,.xls,.csv" class="hidden">
        </div>
        
        <!-- „Éë„Çπ„ÉØ„Éº„ÉâÂÖ•Âäõ„É¢„Éº„ÉÄ„É´ -->
        <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-6 rounded-lg w-full max-w-sm mx-4">
                <h3 class="text-lg font-semibold mb-4">ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ</h3>
                <input type="password" id="admin-password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ" class="w-full p-3 border border-gray-300 rounded-lg mb-4">
                <div class="flex gap-2">
                    <button id="confirm-password" class="flex-1 btn-primary text-white py-2 px-4 rounded-lg">Á¢∫Ë™ç</button>
                    <button id="cancel-password" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">„Ç≠„É£„É≥„Çª„É´</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class QuizApp {
            constructor() {
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.correctAnswers = 0;
                this.totalQuestions = 0;
                this.userAnswers = [];
                this.quizQuestions = [];
                this.dbName = 'VoiceActorQuizDB';
                this.dbVersion = 1;
                this.db = null;
                
                this.initializeApp();
            }
            
            async initializeApp() {
                await this.initDB();
                await this.loadQuestionsFromDB();
                this.setupEventListeners();
                this.updateCategoryOptions();
                this.updateAdminStats();
                this.loadDefaultQuestions();
            }
            
            async initDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.dbVersion);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('questions')) {
                            const store = db.createObjectStore('questions', { keyPath: 'id' });
                            store.createIndex('category', 'category', { unique: false });
                        }
                    };
                });
            }
            
            async saveQuestionsToDB() {
                const transaction = this.db.transaction(['questions'], 'readwrite');
                const store = transaction.objectStore('questions');
                
                // Êó¢Â≠ò„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
                await store.clear();
                
                // Êñ∞„Åó„ÅÑ„Éá„Éº„Çø„Çí‰øùÂ≠ò
                for (const question of this.questions) {
                    await store.add(question);
                }
            }
            
            async loadQuestionsFromDB() {
                const transaction = this.db.transaction(['questions'], 'readonly');
                const store = transaction.objectStore('questions');
                const request = store.getAll();
                
                return new Promise((resolve) => {
                    request.onsuccess = () => {
                        this.questions = request.result || [];
                        resolve();
                    };
                });
            }
            
            loadDefaultQuestions() {
                if (this.questions.length === 0) {
                    this.questions = [
                        {
                            id: 1,
                            category: "‰∏âÂ§ßÊ®©Âà©",
                            question: "Ëëó‰ΩúÈö£Êé•Ê®©„ÅÆ‰∫∫Ê†ºÁöÑÊ®©Âà©„Å´Âê´„Åæ„Çå„Çã„ÇÇ„ÅÆ„ÅØÔºü",
                            options: ["Ê∞èÂêçË°®Á§∫Ê®©„Å®Âêå‰∏ÄÊÄß‰øùÊåÅÊ®©", "Èå≤Èü≥Ê®©„Å®Èå≤ÁîªÊ®©", "ÈÄÅ‰ø°ÂèØËÉΩÂåñÊ®©", "Ë≤∏‰∏éÊ®©"],
                            correct: "Ê∞èÂêçË°®Á§∫Ê®©„Å®Âêå‰∏ÄÊÄß‰øùÊåÅÊ®©",
                            explanation: "Ëëó‰ΩúÈö£Êé•Ê®©„ÅÆ‰∫∫Ê†ºÁöÑÊ®©Âà©„Å´„ÅØ„ÄÅÊ∞èÂêçË°®Á§∫Ê®©ÔºàËá™ÂàÜ„ÅÆÂêçÂâç„ÇíÂÆüÂêç„ÅãÂ§âÂêç„ÅßË°®Á§∫„Åô„Çã„ÅÆ„ÇíÊ±∫„ÇÅ„Çâ„Çå„ÇãÊ®©Âà©Ôºâ„Å®Âêå‰∏ÄÊÄß‰øùÊåÅÊ®©ÔºàËá™ÂàÜ„ÅÆÂÆüÊºî„ÇíÂàáÊúõ„Åó„Åü„ÇäÂêçË™â„ÇíÂÆ≥„Åô„Çã„Åì„Å®„ÇíÂÆà„ÇãÊ®©Âà©Ôºâ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                            type: "Êäû‰∏Ä",
                            hint: ""
                        },
                        {
                            id: 2,
                            category: "Êñ∞‰∫∫Â£∞ÂÑ™„ÅÆÂÆöÁæ©",
                            question: "Êñ∞‰∫∫Â£∞ÂÑ™„Å´„Å®„Å£„Å¶ÊúÄ„ÇÇÈáçË¶Å„Å™ÂïÜÂ£≤ÈÅìÂÖ∑„ÅØÔºü",
                            options: ["Áîü„ÅÆÂ£∞", "„Éû„Ç§„ÇØ„ÇíÈÄö„Åó„ÅüÂ£∞", "ÂÆπÂßø", "ÊºîÊäÄÂäõ"],
                            correct: "„Éû„Ç§„ÇØ„ÇíÈÄö„Åó„ÅüÂ£∞",
                            explanation: "Â£∞ÂÑ™„Å´„Å®„Å£„Å¶„ÄåÂ£∞„Äç„ÅØÊúÄÂ§ß„ÅÆÊ≠¶Âô®„ÄÇ„Åó„Åã„ÅóÈáçË¶Å„Å™„ÅÆ„ÅØ„ÄåÁîü„ÅÆÂ£∞„Äç„Åß„ÅØ„Å™„Åè„Äå„Éû„Ç§„ÇØ„ÇíÈÄö„Åó„ÅüÂ£∞„Äç„Åß„Åô„ÄÇ",
                            type: "Êäû‰∏Ä",
                            hint: "„Éû„Ç§„ÇØ"
                        },
                        {
                            id: 3,
                            category: "Â£∞ÂÑ™„ÅÆ3Ë¶ÅÁ¥†",
                            question: "ÁèæÂ†¥„ÅßÂøÖË¶Å„Å®„Åï„Çå„ÇãÂ£∞ÂÑ™„ÅÆ3Ë¶ÅÁ¥†„Å®„Åó„Å¶Ê≠£„Åó„ÅÑ„ÇÇ„ÅÆ„ÅØÔºü",
                            options: ["ÊºîÊäÄ„ÄÅÂ£∞„ÄÅ‰∫∫ÈñìÊÄß", "ÊäÄË°ì„ÄÅÁµåÈ®ì„ÄÅÊâçËÉΩ", "ÂÄãÊÄß„ÄÅÂä™Âäõ„ÄÅÈÅã", "Áü•Ë≠ò„ÄÅ‰ΩìÂäõ„ÄÅÁ≤æÁ•ûÂäõ"],
                            correct: "ÊºîÊäÄ„ÄÅÂ£∞„ÄÅ‰∫∫ÈñìÊÄß",
                            explanation: "ÁèæÂ†¥„ÅßÂøÖË¶Å„Å®„Åï„Çå„ÇãÂ£∞ÂÑ™„ÅÆ3Ë¶ÅÁ¥†„ÅØÊºîÊäÄ„ÄÅÂ£∞„ÄÅ‰∫∫ÈñìÊÄß„Åß„Åô„ÄÇ",
                            type: "Êäû‰∏Ä",
                            hint: ""
                        },
                        {
                            id: 4,
                            category: "‰∏âÂ§ßÊ®©Âà©",
                            question: "Ëëó‰ΩúÈö£Êé•Ê®©„ÅØÊ∫ñÂâµ‰ΩúÁöÑ‰ΩúÊ•≠„ÇíË©ï‰æ°„Åï„ÇåÁîü„Åæ„Çå„ÅüÊ®©Âà©„Åß„ÅÇ„Çã",
                            options: ["Ê≠£„Åó„ÅÑ", "ÈñìÈÅï„ÅÑ"],
                            correct: "Ê≠£„Åó„ÅÑ",
                            explanation: "Ëëó‰ΩúÈö£Êé•Ê®©„Å®„ÅØ„ÄÅÊ∫ñÂâµ‰ΩúÁöÑ‰ΩúÊ•≠„ÇíË©ï‰æ°„Åï„ÇåÁîü„Åæ„Çå„ÅüÊ®©Âà©„Åß„Åô„ÄÇÂØæË±°„ÅØÂÆüÊºîÂÆ∂ÔºàÂ£∞ÂÑ™„Éª‰ø≥ÂÑ™„ÉªÊ≠åÊâãÔºâ„ÄÅ„É¨„Ç≥„Éº„ÉâÂà∂‰ΩúËÄÖ„ÄÅÊîæÈÄÅ‰∫ãÊ•≠ËÄÖ„ÄÅÊúâÁ∑öÊîæÈÄÅ‰∫ãÊ•≠ËÄÖ„Åß„Åô„ÄÇ",
                            type: "tf",
                            hint: ""
                        },
                        {
                            id: 5,
                            category: "„ÉÜ„É¨„Éì„Éª„Ç¢„Éã„É°Ê•≠Áïå„ÅÆÊ≠¥Âè≤",
                            question: "ÂãùÁî∞‰πÖ„ÅÆÂ£∞ÂÑ™Â≠¶Ê†°„ÅÆÂçíÊ•≠Áîü„Å®„Åó„Å¶Ê≠£„Åó„ÅÑ„ÇÇ„ÅÆ„Çí„Åô„Åπ„Å¶ÈÅ∏Êäû„Åõ„Çà„ÄÇ",
                            options: ["È´òÊú®Ê∏â", "Ê£ÆÂ∑ùÊô∫‰πã", "‰∏âÁü≥Áê¥‰πÉ", "ÈáéÊ≤¢ÈõÖÂ≠ê"],
                            correct: ["È´òÊú®Ê∏â", "Ê£ÆÂ∑ùÊô∫‰πã", "‰∏âÁü≥Áê¥‰πÉ"],
                            explanation: "ÂãùÁî∞‰πÖ„ÅÆÂ£∞ÂÑ™Â≠¶Ê†°„ÅÆÂçíÊ•≠Áîü„ÅØ„ÄÅÈ´òÊú®Ê∏â„ÄÅÊ£ÆÂ∑ùÊô∫‰πã„ÄÅ‰∏âÁü≥Áê¥‰πÉ„ÄÅÈñ¢Êô∫‰∏Ä„Åß„Åô„ÄÇ",
                            type: "Ë§áÊï∞ÈÅ∏Êäû",
                            hint: ""
                        }
                    ];
                    this.saveQuestionsToDB();
                    this.updateCategoryOptions();
                }
            }
            
            setupEventListeners() {
                // „É°„Éã„É•„Éº„Éú„Çø„É≥
                document.getElementById('start-quiz').addEventListener('click', () => this.startQuiz());
                document.getElementById('admin-mode').addEventListener('click', () => this.showPasswordModal());
                
                // „ÇØ„Ç§„Ç∫ÁîªÈù¢„Éú„Çø„É≥
                document.getElementById('submit-answer').addEventListener('click', () => this.submitAnswer());
                document.getElementById('show-hint').addEventListener('click', () => this.showHint());
                document.getElementById('next-question').addEventListener('click', () => this.nextQuestion());
                document.getElementById('back-to-menu').addEventListener('click', () => this.backToMenu());
                
                // ÁµêÊûúÁîªÈù¢„Éú„Çø„É≥
                document.getElementById('retry-quiz').addEventListener('click', () => this.retryQuiz());
                document.getElementById('back-to-main').addEventListener('click', () => this.backToMenu());
                
                // ÁÆ°ÁêÜÁîªÈù¢„Éú„Çø„É≥
                document.getElementById('close-admin').addEventListener('click', () => this.closeAdmin());
                document.getElementById('import-excel').addEventListener('click', () => this.importExcel());
                document.getElementById('export-excel').addEventListener('click', () => this.exportExcel());
                document.getElementById('clear-data').addEventListener('click', () => this.clearData());
                
                // „Éë„Çπ„ÉØ„Éº„Éâ„É¢„Éº„ÉÄ„É´
                document.getElementById('confirm-password').addEventListener('click', () => this.confirmPassword());
                document.getElementById('cancel-password').addEventListener('click', () => this.cancelPassword());
                
                // „Éï„Ç°„Ç§„É´ÂÖ•Âäõ
                document.getElementById('file-input').addEventListener('change', (e) => this.handleFileUpload(e));
            }
            
            updateCategoryOptions() {
                const categorySelect = document.getElementById('question-category');
                const categories = [...new Set(this.questions.map(q => q.category))].sort();
                
                // ÁèæÂú®„ÅÆÈÅ∏ÊäûÂÄ§„Çí‰øùÂ≠ò
                const currentValue = categorySelect.value;
                
                // ÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
                categorySelect.innerHTML = '<option value="all">ÂÖ®ÂàÜÈáé„É©„É≥„ÉÄ„É†</option>';
                
                // Êñ∞„Åó„ÅÑÂàÜÈáé„ÇíËøΩÂä†
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
                
                // Ââç„ÅÆÈÅ∏ÊäûÂÄ§„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅØÂæ©ÂÖÉ
                if (currentValue && [...categorySelect.options].some(opt => opt.value === currentValue)) {
                    categorySelect.value = currentValue;
                }
            }
            
            updateAdminStats() {
                const categories = [...new Set(this.questions.map(q => q.category))];
                document.getElementById('question-count-display').textContent = this.questions.length;
                document.getElementById('category-count-display').textContent = categories.length;
            }
            
            startQuiz() {
                const questionCount = parseInt(document.getElementById('question-count').value);
                const category = document.getElementById('question-category').value;
                
                let availableQuestions = this.questions;
                if (category !== 'all') {
                    availableQuestions = this.questions.filter(q => q.category === category);
                }
                
                if (availableQuestions.length === 0) {
                    alert('ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÁÆ°ÁêÜ„É¢„Éº„Éâ„Åã„ÇâÂïèÈ°å„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
                
                // ÂïèÈ°å„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶ÊåáÂÆöÊï∞„Å†„ÅëÂèñÂæó
                this.quizQuestions = this.shuffleArray([...availableQuestions]).slice(0, questionCount);
                this.currentQuestionIndex = 0;
                this.correctAnswers = 0;
                this.userAnswers = [];
                this.totalQuestions = this.quizQuestions.length;
                
                this.showScreen('quiz-screen');
                this.displayQuestion();
            }
            
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            displayQuestion() {
                const question = this.quizQuestions[this.currentQuestionIndex];
                
                // ÈÄ≤ÊçóÊõ¥Êñ∞
                document.getElementById('current-question').textContent = this.currentQuestionIndex + 1;
                document.getElementById('total-questions').textContent = this.totalQuestions;
                document.getElementById('accuracy').textContent = 
                    this.currentQuestionIndex === 0 ? '0%' : 
                    Math.round((this.correctAnswers / this.currentQuestionIndex) * 100) + '%';
                
                const progress = ((this.currentQuestionIndex + 1) / this.totalQuestions) * 100;
                document.getElementById('progress-bar').style.width = progress + '%';
                
                // ÂïèÈ°åË°®Á§∫
                document.getElementById('question-text').textContent = question.question;
                
                // ÈÅ∏ÊäûËÇ¢Ë°®Á§∫
                const optionsContainer = document.getElementById('question-options');
                optionsContainer.innerHTML = '';
                
                if (question.type === 'tf') {
                    // True/FalseÂïèÈ°å - Â∏∏„Å´„ÄåÊ≠£„Åó„ÅÑ„Äç„ÄåÈñìÈÅï„ÅÑ„Äç„ÇíË°®Á§∫
                    const tfOptions = ['Ê≠£„Åó„ÅÑ', 'ÈñìÈÅï„ÅÑ'];
                    tfOptions.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.className = 'option-btn w-full p-3 text-left bg-white border border-gray-300 rounded-lg hover:bg-gray-50 compact-text';
                        button.textContent = option;
                        button.onclick = () => this.selectOption(index, button, true);
                        optionsContainer.appendChild(button);
                    });
                } else if (question.type === 'Ë§áÊï∞ÈÅ∏Êäû') {
                    // Ë§áÊï∞ÈÅ∏ÊäûÂïèÈ°å
                    question.options.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.className = 'option-btn w-full p-3 text-left bg-white border border-gray-300 rounded-lg hover:bg-gray-50 compact-text';
                        button.textContent = option;
                        button.onclick = () => this.selectOption(index, button, false);
                        optionsContainer.appendChild(button);
                    });
                    document.getElementById('submit-answer').classList.remove('hidden');
                } else {
                    // Êäû‰∏ÄÂïèÈ°å
                    question.options.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.className = 'option-btn w-full p-3 text-left bg-white border border-gray-300 rounded-lg hover:bg-gray-50 compact-text';
                        button.textContent = option;
                        button.onclick = () => this.selectOption(index, button, true);
                        optionsContainer.appendChild(button);
                    });
                }
                
                // „Éí„É≥„ÉàË®≠ÂÆö
                if (question.hint) {
                    document.getElementById('show-hint').classList.remove('hidden');
                } else {
                    document.getElementById('show-hint').classList.add('hidden');
                }
                
                // „É™„Çª„ÉÉ„Éà
                document.getElementById('question-hint').classList.add('hidden');
                document.getElementById('answer-feedback').classList.add('hidden');
                document.getElementById('next-question').classList.add('hidden');
                this.selectedOptions = [];
            }
            
            selectOption(index, button, autoSubmit) {
                const question = this.quizQuestions[this.currentQuestionIndex];
                
                if (question.type === 'Ë§áÊï∞ÈÅ∏Êäû') {
                    // Ë§áÊï∞ÈÅ∏Êäû„ÅÆÂ†¥Âêà
                    if (this.selectedOptions.includes(index)) {
                        this.selectedOptions = this.selectedOptions.filter(i => i !== index);
                        button.classList.remove('selected');
                    } else {
                        this.selectedOptions.push(index);
                        button.classList.add('selected');
                    }
                } else {
                    // Êäû‰∏Ä„ÉªT/FÂïèÈ°å„ÅÆÂ†¥Âêà
                    document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    this.selectedOptions = [index];
                    
                    if (autoSubmit) {
                        setTimeout(() => this.submitAnswer(), 300);
                    }
                }
            }
            
            submitAnswer() {
                const question = this.quizQuestions[this.currentQuestionIndex];
                
                if (this.selectedOptions.length === 0) {
                    alert('ÈÅ∏ÊäûËÇ¢„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
                
                let selectedAnswers, isCorrect;
                
                if (question.type === 'tf') {
                    // T/FÂïèÈ°å„ÅÆÂ†¥Âêà
                    const tfOptions = ['Ê≠£„Åó„ÅÑ', 'ÈñìÈÅï„ÅÑ'];
                    selectedAnswers = this.selectedOptions.map(i => tfOptions[i]);
                    const userAnswer = selectedAnswers[0];
                    const correctAnswer = (question.correct === 'true' || question.correct === 'Ê≠£„Åó„ÅÑ') ? 'Ê≠£„Åó„ÅÑ' : 'ÈñìÈÅï„ÅÑ';
                    isCorrect = userAnswer === correctAnswer;
                } else {
                    // Êäû‰∏Ä„ÉªË§áÊï∞ÈÅ∏ÊäûÂïèÈ°å„ÅÆÂ†¥Âêà
                    selectedAnswers = this.selectedOptions.map(i => question.options[i]);
                    
                    if (question.type === 'Ë§áÊï∞ÈÅ∏Êäû') {
                        const correctAnswers = Array.isArray(question.correct) ? question.correct : [question.correct];
                        isCorrect = selectedAnswers.length === correctAnswers.length && 
                                   selectedAnswers.every(answer => correctAnswers.includes(answer));
                    } else {
                        isCorrect = selectedAnswers[0] === question.correct;
                    }
                }
                
                if (isCorrect) {
                    this.correctAnswers++;
                }
                
                this.userAnswers.push({
                    question: question.question,
                    userAnswer: selectedAnswers,
                    correct: question.correct,
                    isCorrect: isCorrect
                });
                
                this.showAnswerFeedback(isCorrect, selectedAnswers, question);
                
                // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
                document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
                document.getElementById('submit-answer').classList.add('hidden');
                document.getElementById('next-question').classList.remove('hidden');
            }
            
            showAnswerFeedback(isCorrect, selectedAnswers, question) {
                const feedbackDiv = document.getElementById('answer-feedback');
                const resultIcon = document.getElementById('result-icon');
                const resultText = document.getElementById('result-text');
                const userAnswer = document.getElementById('user-answer');
                const correctAnswer = document.getElementById('correct-answer');
                const explanation = document.getElementById('explanation');
                
                if (isCorrect) {
                    feedbackDiv.className = 'answer-feedback correct-answer mb-3 p-3 rounded-lg';
                    resultIcon.textContent = 'üéâ';
                    resultText.textContent = 'Ê≠£Ëß£ÔºÅ';
                    userAnswer.textContent = `‚úÖ „ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î: ${selectedAnswers.join(', ')}`;
                    correctAnswer.textContent = '';
                } else {
                    feedbackDiv.className = 'answer-feedback incorrect-answer mb-3 p-3 rounded-lg';
                    resultIcon.textContent = '‚ùå';
                    resultText.textContent = '‰∏çÊ≠£Ëß£';
                    userAnswer.textContent = `‚ùå „ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î: ${selectedAnswers.join(', ')}`;
                    let correctText;
                    if (question.type === 'tf') {
                        correctText = (question.correct === 'true' || question.correct === 'Ê≠£„Åó„ÅÑ') ? 'Ê≠£„Åó„ÅÑ' : 'ÈñìÈÅï„ÅÑ';
                    } else {
                        correctText = Array.isArray(question.correct) ? question.correct.join(', ') : question.correct;
                    }
                    correctAnswer.textContent = `‚úÖ Ê≠£Ëß£: ${correctText}`;
                }
                
                explanation.textContent = `üí° ${question.explanation}`;
                feedbackDiv.classList.remove('hidden');
            }
            
            showHint() {
                const question = this.quizQuestions[this.currentQuestionIndex];
                if (question.hint) {
                    document.getElementById('hint-text').textContent = question.hint;
                    document.getElementById('question-hint').classList.remove('hidden');
                }
            }
            
            nextQuestion() {
                if (this.currentQuestionIndex < this.totalQuestions - 1) {
                    this.currentQuestionIndex++;
                    this.displayQuestion();
                } else {
                    this.showResults();
                }
            }
            
            showResults() {
                const accuracy = Math.round((this.correctAnswers / this.totalQuestions) * 100);
                
                document.getElementById('final-score').textContent = `${accuracy}%`;
                document.getElementById('final-message').textContent = 
                    accuracy >= 90 ? 'Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ' :
                    accuracy >= 70 ? '„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ' :
                    accuracy >= 50 ? '„ÇÇ„ÅÜÂ∞ë„ÅóÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ' :
                    'Âæ©Áøí„ÅåÂøÖË¶Å„Åß„ÅôÔºÅ';
                
                document.getElementById('final-stats').textContent = 
                    `${this.correctAnswers}ÂïèÊ≠£Ëß£ / ${this.totalQuestions}Âïè‰∏≠`;
                
                this.showScreen('result-screen');
            }
            
            retryQuiz() {
                this.startQuiz();
            }
            
            backToMenu() {
                this.showScreen('main-menu');
            }
            
            showScreen(screenId) {
                const screens = ['main-menu', 'quiz-screen', 'result-screen', 'admin-screen'];
                screens.forEach(screen => {
                    document.getElementById(screen).classList.add('hidden');
                });
                document.getElementById(screenId).classList.remove('hidden');
            }
            
            showPasswordModal() {
                document.getElementById('password-modal').classList.remove('hidden');
                document.getElementById('admin-password').focus();
            }
            
            confirmPassword() {
                const password = document.getElementById('admin-password').value;
                if (password === 'admin2024') {
                    document.getElementById('password-modal').classList.add('hidden');
                    document.getElementById('admin-password').value = '';
                    this.showScreen('admin-screen');
                    this.updateAdminStats();
                } else {
                    alert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                }
            }
            
            cancelPassword() {
                document.getElementById('password-modal').classList.add('hidden');
                document.getElementById('admin-password').value = '';
            }
            
            closeAdmin() {
                this.showScreen('main-menu');
            }
            
            importExcel() {
                document.getElementById('file-input').click();
            }
            
            async handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const data = await this.readExcelFile(file);
                    this.questions = data;
                    await this.saveQuestionsToDB();
                    this.updateCategoryOptions(); // ÂàÜÈáéÈÅ∏ÊäûËÇ¢„ÇíÊõ¥Êñ∞
                    this.updateAdminStats();
                    alert('„Éá„Éº„Çø„ÅÆ„Ç§„É≥„Éù„Éº„Éà„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇÂàÜÈáéÈÅ∏ÊäûËÇ¢„ÇÇÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                } catch (error) {
                    alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
                }
            }
            
            readExcelFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet);
                            
                            const questions = jsonData.map((row, index) => {
                                const options = [row['ÈÅ∏ÊäûËÇ¢1'], row['ÈÅ∏ÊäûËÇ¢2'], row['ÈÅ∏ÊäûËÇ¢3'], row['ÈÅ∏ÊäûËÇ¢4']].filter(Boolean);
                                let correct = row['Ê≠£Ëß£'];
                                
                                // Ë§áÊï∞ÈÅ∏Êäû„ÅÆÂ†¥Âêà„ÅÆÊ≠£Ëß£Âá¶ÁêÜ
                                if (row['ÂΩ¢Âºè'] === 'Ë§áÊï∞ÈÅ∏Êäû' && typeof correct === 'string') {
                                    if (correct.includes(';')) {
                                        correct = correct.split(';');
                                    } else if (correct.includes(',')) {
                                        correct = correct.split(',');
                                    }
                                }
                                
                                return {
                                    id: row['ID'] || index + 1,
                                    category: row['ÂàÜÈáé'] || '„Åù„ÅÆ‰ªñ',
                                    question: row['ÂïèÈ°åÊñá'] || '',
                                    options: options,
                                    correct: correct,
                                    explanation: row['Ëß£Ë™¨'] || '',
                                    type: row['ÂΩ¢Âºè'] || 'Êäû‰∏Ä',
                                    hint: row['„Éí„É≥„Éà'] || ''
                                };
                            });
                            
                            resolve(questions);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = reject;
                    reader.readAsArrayBuffer(file);
                });
            }
            
            exportExcel() {
                const data = this.questions.map(q => ({
                    'ID': q.id,
                    'ÂàÜÈáé': q.category,
                    'ÂïèÈ°åÊñá': q.question,
                    'ÈÅ∏ÊäûËÇ¢1': q.options[0] || '',
                    'ÈÅ∏ÊäûËÇ¢2': q.options[1] || '',
                    'ÈÅ∏ÊäûËÇ¢3': q.options[2] || '',
                    'ÈÅ∏ÊäûËÇ¢4': q.options[3] || '',
                    'Ê≠£Ëß£': Array.isArray(q.correct) ? q.correct.join(';') : q.correct,
                    'Ëß£Ë™¨': q.explanation,
                    'ÂΩ¢Âºè': q.type,
                    '„Éí„É≥„Éà': q.hint,
                    'ÂÇôËÄÉ': '',
                    'Ê≠£Ëß£3': Array.isArray(q.correct) ? q.correct.map(c => `ÈÅ∏ÊäûËÇ¢${q.options.indexOf(c) + 1}`).join(';') : `ÈÅ∏ÊäûËÇ¢${q.options.indexOf(q.correct) + 1}`
                }));
                
                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Questions');
                
                const fileName = 'voice_actor_quiz_questions.xlsx';
                XLSX.writeFile(workbook, fileName);
            }
            
            async clearData() {
                if (confirm('„Åô„Åπ„Å¶„ÅÆÂïèÈ°å„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                    this.questions = [];
                    await this.saveQuestionsToDB();
                    this.updateCategoryOptions(); // ÂàÜÈáéÈÅ∏ÊäûËÇ¢„ÇíÊõ¥Êñ∞
                    this.updateAdminStats();
                    alert('„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü„ÄÇ');
                }
            }
        }
        
        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÈñãÂßã
        document.addEventListener('DOMContentLoaded', () => {
            new QuizApp();
        });
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"96128a68ff1b62e1","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.7.0","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDsxkJu18m5BkHHJ%2BNRmUBfgmXEZ3ESXpzXw9vBBWTd7vhFMeIYklqjJOnUMNgpbBXR160gUfkkBoLNRY8eSPMzEbOHUAUR7hwJbuVTr%2FSATJTGH8T7%2F680PZqTr3Fj90LK1DxJCVSjkp92j2SC0qIX2TdWTsQ1fJjCkDy9LMj6WvaO%2Fl8hYyGYrNBsGs80Oqpu4L5fMxLY%2BKmTl7UzP0XzFO4XQPvRr3oEH9VXt%2B64b09ih4f395nTkAA7Orur6ymH%2Fh1Pd64ZrZGIZDpkAdr7fl7gdMOBL8AUQ5y4U%2FboCgvoum%2BbRjnaAI87uSP95%2BJNkMNcDu6Ri5a5M5fpNWTxompkND4Uf6JWi674RiKy%2BXjeXQcgYdErOqrrYRiHZud%2BkZMIHNVS7qYvlNrUIMgyU7%2FM1fgj%2BxBM%2BR62EULg52B7%2BZj8IkO7s%2BrSmztI%2BTOF1pQOOPvZkzBuuG8GXUlV2Hy%2Bj403ryBCj%2BIySUhWVVew3N3MN43qB%2BjtKit6l0GjkgQy12xWktvrlwGqCp1n0%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDsxkJu18m5BkHHJ+NRmUBfgmXEZ3ESXpzXw9vBBWTd7vhFMeIYklqjJOnUMNgpbBXR160gUfkkBoLNRY8eSPMzEbOHUAUR7hwJbuVTr/SATJTGH8T7/680PZqTr3Fj90LK1DxJCVSjkp92j2SC0qIX2TdWTsQ1fJjCkDy9LMj6WvaO/l8hYyGYrNBsGs80Oqpu4L5fMxLY+KmTl7UzP0XzFO4XQPvRr3oEH9VXt+64b09ih4f395nTkAA7Orur6ymH/h1Pd64ZrZGIZDpkAdr7fl7gdMOBL8AUQ5y4U/boCgvoum+bRjnaAI87uSP95+JNkMNcDu6Ri5a5M5fpNWTxompkND4Uf6JWi674RiKy+XjeXQcgYdErOqrrYRiHZud+kZMIHNVS7qYvlNrUIMgyU7/M1fgj+xBM+R62EULg52B7+Zj8IkO7s+rSmztI+TOF1pQOOPvZkzBuuG8GXUlV2Hy+j403ryBCj+IySUhWVVew3N3MN43qB+jtKit6l0GjkgQy12xWktvrlwGqCp1n0=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    